<?xml version="1.0" encoding="utf-8"?>
<AdminArsenal.Export Code="PDQDeploy" Name="PDQ Deploy" Version="18.1.0.0" MinimumVersion="15.0">
  <Package>
    <CurrentLibraryPackageVersionId value="null" />
    <PackageDefinition name="Definition">
      <Conditions type="list">
        <PackageStepCondition>
          <Architecture>Both</Architecture>
          <Version>All</Version>
          <TypeName>OperatingSystem</TypeName>
        </PackageStepCondition>
        <PackageStepCondition>
          <IsUserLoggedOn>NoLoggedOnUser</IsUserLoggedOn>
          <TypeName>LoggedOnUser</TypeName>
        </PackageStepCondition>
        <PackageStepCondition>
          <ConditionMode>None</ConditionMode>
          <InventoryCollectionId value="null" />
          <InventoryCollectionName></InventoryCollectionName>
          <TypeName>Collection</TypeName>
        </PackageStepCondition>
      </Conditions>
      <CopyMode>Default</CopyMode>
      <DelayedApprovalTimeSpan>7.00:00:00</DelayedApprovalTimeSpan>
      <DownloadApprovalMode>Manual</DownloadApprovalMode>
      <InventoryScanProfileId value="null" />
      <IsDownloadApprovalModeInherited value="true" />
      <ScanAfterDeployment value="null" />
      <Steps type="list">
        <PowerShellStep>
          <CustomCommandLine></CustomCommandLine>
          <Files></Files>
          <Script># Update Me
[Array]$Programs = @(

)

[Array]$ProgramDirs = @(
    "$Env:ProgramFiles\Notepad++\"
    "${Env:ProgramFiles(x86)}\Notepad++\"
)

# Don't Edit Below this line
###############################################################################################################################
New-Variable -Name Processes -Value (Get-Process |Select Id,Path) -Description "List of all running processes." -Force
New-Variable -Name Running1 -Value @{} -Description "List of all running applications that need to be killed." -Force
New-Variable -Name Running2 -Value @{} -Description "List of all running applications that need to be killed." -Force

IF (![string]::IsNullOrEmpty($ProgramDirs)) {
    $Running1 = $Processes.path | Select-String -Pattern $ProgramDirs -SimpleMatch |Select -Unique
}

IF (![string]::IsNullOrEmpty($Programs)) {
    $Running2 = $Processes.path | Select-String -Pattern $Programs -SimpleMatch |Select -Unique
}
Try {
    ForEach ($Process in ($Running1,$Running2)) {
            $Processes | Where {$_.path -eq $Process} |Stop-Process -Force
    }
    Exit 0
} Catch {
    $_.Exception
    Exit 1
}</Script>
          <SuccessCodes>0</SuccessCodes>
          <RunAs value="null" />
          <Conditions type="list">
            <PackageStepCondition>
              <Architecture>Both</Architecture>
              <Version>All</Version>
              <TypeName>OperatingSystem</TypeName>
            </PackageStepCondition>
            <PackageStepCondition>
              <IsUserLoggedOn>AlwaysRun</IsUserLoggedOn>
              <TypeName>LoggedOnUser</TypeName>
            </PackageStepCondition>
            <PackageStepCondition>
              <ConditionMode>None</ConditionMode>
              <InventoryCollectionId value="null" />
              <InventoryCollectionName></InventoryCollectionName>
              <TypeName>Collection</TypeName>
            </PackageStepCondition>
          </Conditions>
          <ErrorMode>StopDeploymentFail</ErrorMode>
          <Title>Stop Processes (v3)</Title>
          <TypeName>PowerShell</TypeName>
          <IsEnabled value="true" />
          <IsPostStep value="false" />
          <IsPreStep value="false" />
        </PowerShellStep>
        <PowerShellStep>
          <CustomCommandLine></CustomCommandLine>
          <Files></Files>
          <Script>#Update Me
[String]$Search = 'Notepad++'

#Possible Options are: 'Regex','Simple',Exact'
[String]$SearchType = 'Simple'

#Possible options are "x86", "x64" and "both"
[String]$Arch = 'x86'

# If uninstaller is an exe use these silent uninstall flags. If no flags should be added but still attempt exe uninstalls
# using the ininstall string use 'none'
[String]$EXEFlags = '/s'

# Don't Edit Below this line
###############################################################################################################################
[Bool]$Debug = $False
[Array]$Properties = @('DisplayName', 'DisplayVersion', 'ParentKey', 'UninstallString', 'AppArch')
[System.Collections.ArrayList]$Keys = New-Object -TypeName 'System.Collections.ArrayList'
[Void]$Keys.Add([PSObject]@{
        'HKLM' = "Software\Microsoft\Windows\CurrentVersion\Uninstall"
    })

IF ([System.Environment]::Is64BitOperatingSystem) {
    [Void]$Keys.Add([PSObject]@{
            'HKLM' = "SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall"
        })
}
[Array]$UserKeys = Get-ChildItem -Path Registry::HKEY_USERS
FOREACH ($UserKey IN $UserKeys) {
    [Void]$Keys.Add([PSObject]@{
            'HKU' = "$UserKey\Software\Microsoft\Windows\CurrentVersion\Uninstall"
        })
}

[System.Collections.ArrayList]$Result = New-Object -TypeName 'System.Collections.ArrayList'
FOREACH ($Key IN $Keys) {
    SWITCH ($Key.Keys) {
        'HKLM' {
            $BaseKey = [Microsoft.Win32.RegistryKey]::OpenRemoteBaseKey([Microsoft.Win32.RegistryHive]::LocalMachine, $ENV:ComputerName)
        }
        'HKU'  {
            $BaseKey = [Microsoft.Win32.RegistryKey]::OpenRemoteBaseKey([Microsoft.Win32.RegistryHive]::Users, $ENV:ComputerName)
        }
        Default {
            Write-Error -Message "Invalid registry key root."
            EXIT 1
        }
    }
    $RegKey = $BaseKey.OpenSubkey($key.Values[0])
    IF ($RegKey -ne $null) {
        FOREACH ($subName IN $RegKey.getsubkeynames()) {
            FOREACH ($sub IN $RegKey.opensubkey($subName)) {
                [string]$Name = $sub.getvalue("displayname")
                IF ($Name.trim().Length -gt 0) {
                    
                    #If search option selected and $Name doesn't match, move to next item
                    IF (![string]::IsNullOrEmpty($Search) -AND (
                            ($SearchType -eq 'Regex' -AND $Name -NotMatch $Search) -OR
                            ($SearchType -eq 'Simple' -AND $Name -NOTLIKE "*$Search*") -OR
                            ($SearchType -eq 'Exact' -AND $Name -NE $Search))
                    ) {
                        CONTINUE
                    }
                    
                    $HashProperty = @{
                    } #This should probably be; New-Object -TypeName 'System.Collections.ArrayList'
                    FOREACH ($CurrentProperty IN $Properties) {
                        SWITCH ($CurrentProperty) {
                            "ParentKey" {
                                $HashProperty.ParentKey = $subName
                            }
                            "AppArch" {
                                IF ($Keys.Count -eq 2 -AND $Key -eq $Keys[0]) {
                                    $HashProperty.AppArch = "x64"
                                } ELSE {
                                    $HashProperty.AppArch = "x86"
                                }
                            }
                            Default {
                                $HashProperty.$CurrentProperty = $sub.GetValue($CurrentProperty)
                            }
                        }
                    } #End-ForEach
                    $HashProperty.RegKey = $RegKey
                    [Void]$Result.add([psCustomObject]$HashProperty)
                } #End-IF
            } #End-ForEach
        } #End-Foreach
    } #End-IF
} #End-ForEach

FOREACH ($App IN ($Result | Where-Object {
            $_.AppArch -eq $Arch -OR $Arch -eq "Both"
        })) {
    IF ($App.UninstallString -match "msiexec") {
        $ProcessStartInfo = New-Object System.Diagnostics.ProcessStartInfo
        $ProcessStartInfo.FileName = "$ENV:Windir\System32\msiexec.exe"
        $ProcessStartInfo.Arguments = "/x $($App.ParentKey) /qn"
        $ProcessStartInfo.CreateNoWindow = $True
        $ProcessStartInfo.UseShellExecute = $False
        $ProcessStartInfo.RedirectStandardOutput = $True
        $ProcessStartInfo.RedirectStandardInput = $True
        $ProcessStartInfo.RedirectStandardError = $True
        $ProcessStartInfo.WindowStyle = [System.Diagnostics.ProcessWindowStyle]::Hidden
        $ProcessStartInfo.LoadUserProfile = $False
        IF ($Debug) {
            Write-Output "Installing $($App.Name)"
        } ELSE {
            $Process = [System.Diagnostics.Process]::Start($ProcessStartInfo)
            $Process.WaitForExit()
        }
        
    } ELSEIF ($App.UninstallString -match ".exe") {
        IF ([string]::IsNullOrEmpty($EXEFlags.Trim()) -AND $EXEFlags -ne "None") {
            Write-Error -Message "EXE detected but no 'EXEFlags' have been configured. "
        } Else {
            $ProcessStartInfo = New-Object System.Diagnostics.ProcessStartInfo
            $ProcessStartInfo.FileName = $App.UninstallString
            $ProcessStartInfo.Arguments = $EXEFlags
            $ProcessStartInfo.CreateNoWindow = $True
            $ProcessStartInfo.UseShellExecute = $False
            $ProcessStartInfo.RedirectStandardOutput = $True
            $ProcessStartInfo.RedirectStandardInput = $True
            $ProcessStartInfo.RedirectStandardError = $True
            $ProcessStartInfo.WindowStyle = [System.Diagnostics.ProcessWindowStyle]::Hidden
            $ProcessStartInfo.LoadUserProfile = $False
            IF ($Debug) {
                Write-Output "Debug: Installing $($App.DisplayName)"
            } ELSE {
                $Process = [System.Diagnostics.Process]::Start($ProcessStartInfo)
                $Process.WaitForExit()
            }
        }
    } ELSEIF([string]::IsNullOrEmpty($App.UninstallString))  {
        Write-Output "Wing"
    } Else {
        Write-Output "Unable to handle these kinds of installers"
        Write-Output $App.DisplayName
    }
}</Script>
          <SuccessCodes>0</SuccessCodes>
          <RunAs value="null" />
          <Conditions type="list">
            <PackageStepCondition>
              <Architecture>Bits64</Architecture>
              <Version>All</Version>
              <TypeName>OperatingSystem</TypeName>
            </PackageStepCondition>
            <PackageStepCondition>
              <IsUserLoggedOn>AlwaysRun</IsUserLoggedOn>
              <TypeName>LoggedOnUser</TypeName>
            </PackageStepCondition>
            <PackageStepCondition>
              <ConditionMode>None</ConditionMode>
              <InventoryCollectionId value="null" />
              <InventoryCollectionName></InventoryCollectionName>
              <TypeName>Collection</TypeName>
            </PackageStepCondition>
          </Conditions>
          <ErrorMode>StopDeploymentFail</ErrorMode>
          <Title>Uninstaller (v3): Uninstall 32-bit package on 64-bit systems.</Title>
          <TypeName>PowerShell</TypeName>
          <IsEnabled value="true" />
          <IsPostStep value="false" />
          <IsPreStep value="false" />
        </PowerShellStep>
        <InstallStep>
          <CustomCommandLine></CustomCommandLine>
          <FileName>$(Repository)\Notepad-plus-plus\7.8.2\x86\npp.7.8.2.Installer.exe</FileName>
          <Files></Files>
          <IncludeDirectory value="false" />
          <LeaveInstallFile value="false" />
          <MsiOperation>Install</MsiOperation>
          <MsiQuiet value="true" />
          <MsiRestart>Never</MsiRestart>
          <Parameters>/S</Parameters>
          <SuccessCodes>0,1641,3010</SuccessCodes>
          <RunAs value="null" />
          <Conditions type="list">
            <PackageStepCondition>
              <Architecture>Bits32</Architecture>
              <Version>All</Version>
              <TypeName>OperatingSystem</TypeName>
            </PackageStepCondition>
            <PackageStepCondition>
              <IsUserLoggedOn>AlwaysRun</IsUserLoggedOn>
              <TypeName>LoggedOnUser</TypeName>
            </PackageStepCondition>
            <PackageStepCondition>
              <ConditionMode>None</ConditionMode>
              <InventoryCollectionId value="null" />
              <InventoryCollectionName></InventoryCollectionName>
              <TypeName>Collection</TypeName>
            </PackageStepCondition>
          </Conditions>
          <ErrorMode>StopDeploymentFail</ErrorMode>
          <Title>Install Notepad++ (32-Zip)</Title>
          <TypeName>Install</TypeName>
          <IsEnabled value="true" />
          <IsPostStep value="false" />
          <IsPreStep value="false" />
        </InstallStep>
        <InstallStep>
          <CustomCommandLine></CustomCommandLine>
          <FileName>$(Repository)\Notepad-plus-plus\7.8.2\x64\npp.7.8.2.Installer.x64.exe</FileName>
          <Files></Files>
          <IncludeDirectory value="false" />
          <LeaveInstallFile value="false" />
          <MsiOperation>Install</MsiOperation>
          <MsiQuiet value="true" />
          <MsiRestart>Never</MsiRestart>
          <Parameters>/S</Parameters>
          <SuccessCodes>0,1641,3010</SuccessCodes>
          <RunAs value="null" />
          <Conditions type="list">
            <PackageStepCondition>
              <Architecture>Bits64</Architecture>
              <Version>All</Version>
              <TypeName>OperatingSystem</TypeName>
            </PackageStepCondition>
            <PackageStepCondition>
              <IsUserLoggedOn>AlwaysRun</IsUserLoggedOn>
              <TypeName>LoggedOnUser</TypeName>
            </PackageStepCondition>
            <PackageStepCondition>
              <ConditionMode>None</ConditionMode>
              <InventoryCollectionId value="null" />
              <InventoryCollectionName></InventoryCollectionName>
              <TypeName>Collection</TypeName>
            </PackageStepCondition>
          </Conditions>
          <ErrorMode>StopDeploymentFail</ErrorMode>
          <Title>Install Notepad++ (64-bit)</Title>
          <TypeName>Install</TypeName>
          <IsEnabled value="true" />
          <IsPostStep value="false" />
          <IsPreStep value="false" />
        </InstallStep>
        <PowerShellStep>
          <CustomCommandLine></CustomCommandLine>
          <Files></Files>
          <Script>IF (Test-Path "$ENV:ProgramFiles\NotePad++\updater") {
    Remove-Item -Path "$ENV:ProgramFiles\NotePad++\updater" -Force -Recurse
}
IF (Test-Path "${Env:ProgramFiles(x86)}\NotePad++\updater") {
    Remove-Item -Path "$ENV:ProgramFiles\NotePad++\updater" -Force -Recurse
}</Script>
          <SuccessCodes>0</SuccessCodes>
          <RunAs value="null" />
          <Conditions type="list">
            <PackageStepCondition>
              <Architecture>Both</Architecture>
              <Version>All</Version>
              <TypeName>OperatingSystem</TypeName>
            </PackageStepCondition>
            <PackageStepCondition>
              <IsUserLoggedOn>AlwaysRun</IsUserLoggedOn>
              <TypeName>LoggedOnUser</TypeName>
            </PackageStepCondition>
            <PackageStepCondition>
              <ConditionMode>None</ConditionMode>
              <InventoryCollectionId value="null" />
              <InventoryCollectionName></InventoryCollectionName>
              <TypeName>Collection</TypeName>
            </PackageStepCondition>
          </Conditions>
          <ErrorMode>StopDeploymentFail</ErrorMode>
          <Title>Disable Auto-Updater</Title>
          <TypeName>PowerShell</TypeName>
          <IsEnabled value="true" />
          <IsPostStep value="false" />
          <IsPreStep value="false" />
        </PowerShellStep>
      </Steps>
      <Timeout value="60" />
      <UseCustomTimeout value="false" />
      <RunAs value="null" />
    </PackageDefinition>
    <Description></Description>
    <NewLibraryPackageVersionId value="null" />
    <OriginalId value="null" />
    <Version></Version>
    <IsAutoDownload value="false" />
    <FolderId value="6" />
    <LibraryPackageVersionId value="null" />
    <Name>Notepad++ (v1r4) (v7.8.2)</Name>
    <Path>Packages\Installers\Notepad++ (v1r4) (v7.8.2)</Path>
    <PackageDisplaySettings name="DisplaySettings">
      <DisplayType>Normal</DisplayType>
      <IconKey>Icon-Package</IconKey>
      <SortOrder value="7" />
    </PackageDisplaySettings>
  </Package>
</AdminArsenal.Export>